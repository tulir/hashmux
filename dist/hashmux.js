"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),pieceMatcher=/\{([a-zA-Z]+?)(:[^}]+?)?\}/,regexEscape=/[-[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/,Hashmux=function(){function e(){_classCallCheck(this,e),this.handlers=[],this.errors={404:function(e){return console.error("Page",e.page,"not found!")}}}return _createClass(e,[{key:"error",value:function(e,n){this.errors.hasOwnProperty(e)?this.errors[e](n):this.errors[520](n)}},{key:"handleError",value:function(e,n){this.errors[e]=n}},{key:"handle",value:function(e,n,t){void 0===e||0===e.length?e="/":"function"==typeof e&&(n=e,e="/"),"function"!=typeof n&&(n=function(){console.error("No handler function provided for",e)});var r=e.split("/").slice(1),o=[],i=[],s=t?"i":"",a=!1;r.length>1&&0===r[r.length-1].length&&(r=r.slice(0,r.length-1),a=!0),r.forEach(function(e,n){var t=pieceMatcher.exec(e);null!==t&&t.length>1?(t=t.slice(1),i[n]=t[0],o[n]=void 0!==t[1]&&t[1].length>0?new RegExp("^"+t[1].substr(1)+"$",s):new RegExp("^.+$",s)):o[n]=new RegExp("^"+e.replace(regexEscape,"\\$&")+"$",s)}),this.handlers.push(new Handler(i,o,n,a))}},{key:"handleRaw",value:function(e){this.handlers.push(e)}},{key:"update",value:function(){var e=window.location.hash;0===e.length&&(e="#/");for(var n=e.split("/").slice(1),t=0;t<this.handlers.length;t++){var r=this.handlers[t];if(void 0!==r){var o=r.handle(n);if(void 0!==o){var i=r.func(o);return void(void 0!==i&&"object"===("undefined"==typeof i?"undefined":_typeof(i))&&(i.page=e.substr(1),void 0!==i.status&&200!==i.status&&this.error(i.status,i)))}}}this.error(404,{page:e.substr(1)})}},{key:"listen",value:function(){var e=this;window.onhashchange=function(){return e.update()},this.update()}}]),e}(),Handler=function(){function e(n,t,r,o){_classCallCheck(this,e),void 0===n&&(n=[]),this.args=n,this.regex=t,this.func=r,this.trailingAnything=!!o}return _createClass(e,[{key:"handle",value:function(e){if(this.regex.length>e.length)return void 0;if(this.regex.length<e.length&&!this.trailingAnything)return void 0;for(var n=[],t=0;t<this.regex.length;t++){var r=this.regex[t].exec(e[t]);if(null===r||0===r.length)return void 0;var o=n.length;this.args.length>t&&void 0!==this.args[t]&&(o=this.args[t]),n[o]=decodeURIComponent(r[0])}if(this.trailingAnything)for(;t<e.length;t++)n[t]=decodeURIComponent(e[t]);return n}}]),e}();"undefined"!=typeof module&&module.exports&&(module.exports={Hashmux:Hashmux,Handler:Handler});