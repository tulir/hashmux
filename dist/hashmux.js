"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),pieceMatcher=/\{([a-zA-Z]+?)(:[^}]+?)?\}/,regexEscape=/[-[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/,Hashmux=function(){function e(){_classCallCheck(this,e),this.handlers=[],this.specialHandlers={prehandle:function(){},posthandle:function(){}},this.errors={404:function(e){return console.error("Page",e.page,"not found!")}}}return _createClass(e,[{key:"error",value:function(e,t){this.errors.hasOwnProperty(e)?this.errors[e](t):this.errors[520](t)}},{key:"handleError",value:function(e,t){this.errors[e]=t}},{key:"handle",value:function(e,t,r){void 0===e||0===e.length?e="/":"function"==typeof e&&(t=e,e="/"),"function"!=typeof t&&(t=function(){console.error("No handler function provided for",e)});var n=e.split("/").slice(1),o=[],i=[],a=r?"i":"",l=!1;n.length>1&&0===n[n.length-1].length&&(n=n.slice(0,n.length-1),l=!0);var s=!0,u=!1,h=void 0;try{for(var c,f=Object.entries(n)[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var d=_slicedToArray(c.value,2),y=d[0],p=d[1],g=pieceMatcher.exec(p);null!==g&&g.length>1?(g=g.slice(1),i[y]=g[0],o[y]=void 0!==g[y]&&g[1].length>0?new RegExp("^"+g[1].substr(1)+"$",a):new RegExp("^.+$",a)):o[y]=new RegExp("^"+p.replace(regexEscape,"\\$&")+"$",a)}}catch(e){u=!0,h=e}finally{try{!s&&f.return&&f.return()}finally{if(u)throw h}}this.handlers.push(new Handler(i,o,t,l))}},{key:"handleRaw",value:function(e){this.handlers.push(e)}},{key:"update",value:function(){var e=window.location.hash;0===e.length&&(e="#/");var t=e.split("/").slice(1),r=!0,n=!1,o=void 0;try{for(var i,a=this.handlers[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var l=i.value,s=l.handle(t);if(void 0!==s){this.specialHandlers.prehandle(t,s);var u=l.func(s);return this.specialHandlers.posthandle(t,s,u),void(void 0!==u&&"object"===("undefined"==typeof u?"undefined":_typeof(u))&&(u.page=e.substr(1),void 0!==u.status&&200!==u.status&&this.error(u.status,u)))}}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}this.error(404,{page:e.substr(1)})}},{key:"listen",value:function(){var e=this;window.onhashchange=function(){return e.update()},this.update()}}]),e}(),Handler=function(){function e(t,r,n,o){_classCallCheck(this,e),void 0===t&&(t=[]),this.args=t,this.regex=r,this.func=n,this.trailingAnything=!!o}return _createClass(e,[{key:"handle",value:function(e){if(this.regex.length>e.length)return void 0;if(this.regex.length<e.length&&!this.trailingAnything)return void 0;for(var t=[],r=0;r<this.regex.length;r++){var n=this.regex[r].exec(e[r]);if(null===n||0===n.length)return void 0;var o=t.length;this.args.length>r&&void 0!==this.args[r]&&(o=this.args[r]),t[o]=decodeURIComponent(n[0])}if(this.trailingAnything)for(;r<e.length;r++)t[r]=decodeURIComponent(e[r]);return t}}]),e}();"undefined"!=typeof module&&module.exports&&(module.exports={Hashmux:Hashmux,Handler:Handler});