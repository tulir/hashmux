"use strict";var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var pieceMatcher=/\{([a-zA-Z]+?)(:[^}]+?)?\}/,regexEscape=/[-[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/,Hashmux=function(){function e(){_classCallCheck(this,e),this.oldHash=window.location.hash,this.ignoreUpdate=!1,this.handlers=[],this.specialHandlers={prehandle:function(){},posthandle:function(){}},this.errors={404:function(e){return console.error("Page",e.page,"not found!")}}}return _createClass(e,[{key:"error",value:function(e,t){this.errors.hasOwnProperty(e)?this.errors[e](t):this.errors[520](t)}},{key:"handleError",value:function(e,t){this.errors[e]=t}},{key:"redirect",value:function(e){history.replaceState(void 0,void 0,e)}},{key:"handleRedirect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=this,r=arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("function"!=typeof r){var i=r;r=function(){return i}}this.handle(e,function(e){return t.redirect(r(e))},n)}},{key:"handle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"function"==typeof e?(t=e,e="/"):void 0!==e&&0!==e.length||(e="/"),"function"!=typeof t&&(t=function(){console.error("No handler function provided for",e)});var n=e.split("/").slice(1),i=[],a=[],o=r?"i":"",s=!1;n.length>1&&0===n[n.length-1].length&&(n=n.slice(0,n.length-1),s=!0),n.forEach(function(e,t){var r=pieceMatcher.exec(e);null!==r&&r.length>1?(r=r.slice(1),a[t]=r[0],void 0!==r[t]&&r[1].length>0?i[t]=new RegExp("^"+r[1].substr(1)+"$",o):i[t]=new RegExp("^.+$",o)):i[t]=new RegExp("^"+e.replace(regexEscape,"\\$&")+"$",o)}),this.handlers.push(new Handler(a,i,t,s))}},{key:"handleRaw",value:function(e){this.handlers.push(e)}},{key:"update",value:function(){if(this.ignoreUpdate)this.ignoreUpdate=!1;else{var e=window.location.hash;0===e.length&&(e="#/");var t=Query.parse(e),r=(e=e.split("?",1)[0]).split("/").slice(1),n=!0,i=!1,a=void 0;try{for(var o,s=this.handlers[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,u=l.handle(r);if(void 0!==u){if(this.specialHandlers.prehandle(e,u))return this.ignoreUpdate=!0,void(window.location.hash=this.oldHash);var h=l.func(u,t);if(this.oldHash=e,this.specialHandlers.posthandle(e,u,h))return;return void(void 0!==h&&"object"===(void 0===h?"undefined":_typeof(h))&&(h.page=e.substr(1),void 0!==h.status&&200!==h.status&&this.error(h.status,h)))}}}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}this.error(404,{page:e.substr(1)})}}},{key:"listen",value:function(){var e=this;window.onhashchange=function(){return e.update()},this.update()}}]),e}(),Query=function(){function e(t){if(_classCallCheck(this,e),this.values=new Map,t){var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value,l=s.indexOf("=");if(!(l<1)){var u=s.substr(0,l),h=s.substr(l+1,s.length);this.add(u,h)}}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}}}return _createClass(e,[{key:"toString",value:function(){return[].concat(_toConsumableArray(this.values)).map(function(e){var t=_slicedToArray(e,2),r=t[0];return t[1].map(function(e){return r+"="+e}).join("&")}).join("&")}},{key:"setCurrentURL",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=window.location.hash,r=t.indexOf("?");r>=0&&(t=t.substr(0,r)),t=t+"?"+this.toString(),e?history.replaceState(void 0,void 0,t):window.location.hash=t}},{key:"add",value:function(e,t){var r=this.values.get(e)||[];r.push(t),this.values.set(e,r)}},{key:"set",value:function(e,t){Array.isArray(t)||(t=[t]),this.values.set(e,t)}},{key:"has",value:function(e){return this.values.has(e)}},{key:"getAll",value:function(e){return this.values.get(e)}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.values.get(e);return r?r[t]:void 0}}],[{key:"add",value:function(t,r,n){var i=e.parse();return i.set(t,r),i.setCurrentURL(n),i}},{key:"set",value:function(t,r,n){var i=e.parse();return i.set(t,r),i.setCurrentURL(n),i}},{key:"parse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.hash,r=t.indexOf("?");return r>-1&&(t=t.substr(r+1)),new e(t.split("&"))}}]),e}(),Handler=function(){function e(t,r,n,i){_classCallCheck(this,e),void 0===t&&(t=[]),this.args=t,this.regex=r,this.func=n,this.trailingAnything=!!i}return _createClass(e,[{key:"handle",value:function(e){if(!(this.regex.length>e.length)&&(!(this.regex.length<e.length)||this.trailingAnything)){for(var t=[],r=0;r<this.regex.length;r++){var n=this.regex[r].exec(e[r]);if(null===n||0===n.length)return;var i=t.length;this.args.length>r&&void 0!==this.args[r]&&(i=this.args[r]),t[i]=decodeURIComponent(n[0])}if(this.trailingAnything)for(;r<e.length;r++)t[r]=decodeURIComponent(e[r]);return t}}}]),e}();"undefined"!=typeof module&&module.exports&&(module.exports={Hashmux:Hashmux,Handler:Handler,Query:Query});